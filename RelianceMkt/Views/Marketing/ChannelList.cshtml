@model RelianceMkt.Models.channel
@{
    ViewBag.Title = "Channel List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- 🔴 Duplicate Alert Show -->
@if (TempData["DuplicateMsg"] != null)
{
    <script type="text/javascript">
        alert('@TempData["DuplicateMsg"]');
    </script>
}


<div class="container-fluid">
    <div class="row">
        <div class="col-xl-12 col-xxl-12 col-lg-12">
            <div class="row">
                <div class="col-xl-12">
                    @using (Html.BeginForm("ChannelList", "Marketing", FormMethod.Post))
                    {
                        <div class="card">
                            <div class="card-header pb-0 border-0">
                                <h3 class="fs-20 text-black">Enter your Channel below</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-xl-3">
                                        <label class="text-black font-w500 mb-3">Channel :</label>
                                        <span class="text-danger ml-1">*</span>
                                        @Html.DropDownListFor(x => x.subchannel_name,
                                            ViewBag.NEW_TEMP_HIERARCHY as IEnumerable<SelectListItem> ??
                                            new List<SelectListItem> {
                                                new SelectListItem { Value = "", Text = "-- No Categories Available --", Disabled = true }
                                            },
                                            "-- Select Channel --",
                                            new { @class = "form-control", @required = "true" })
                                    </div>
                                    <div class="form-group col-xl-3">
                                        <label class="text-black font-w500 mb-3">Channel Name:</label>
                                        <span class="text-danger ml-1">*</span>
                                        @Html.TextBoxFor(x => x.channel_name,
                                            new { @class = "form-control", @required = "true", @placeholder = "Enter Channel Name" })
                                    </div>
                                    <div class="form-group col-xl-3" style="padding-top:38px;">
                                        <button type="submit" class="btn btn-primary ml-3">SAVE</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- List start -->
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Channel List</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-responsive-md">
                            <thead>
                                <tr>
                                    <th><strong>S NO.</strong></th>
                                    <th><strong>CHANNEL CODE</strong></th>
                                    <th><strong>CHANNEL NAME</strong></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    int i = 1;
                                    foreach (var item in ViewBag.lstChannel)
                                    {
                                        <tr id="row-@item.channel_id">
                                            <td><strong>@i</strong></td>
                                            <td>@item.subchannel_name   @* This now stores X_CHANNEL *@</td>
                                            <td>@item.channel_name</td>
                                            <td><a href="#" class="btn btn-success" onclick="EditChannel(@item.channel_id)">Edit</a></td>
                                            <td><a href="#" class="btn btn-danger" onclick="DeleteChannel(@item.channel_id)">Delete</a></td>
                                        </tr>
                                        i++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Edit -->
    <div class="modal fade none-border" id="edit-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><strong>Edit Channel</strong></h4>
                </div>
                <div class="modal-body" id="myModalBodyDiv1"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section js
{
    <script src="~/Content/vendor/jqueryui/js/jquery-ui.min.js"></script>
    <script>
        var EditChannel = function (channelid) {
            var url = '@Url.Action("EditChannel", "Marketing")' + '?ChannelId=' + channelid;
            $("#myModalBodyDiv1").load(url, function () {
                $("#edit-modal").modal("show");
            });
        }

        function DeleteChannel(channelId) {
            if (confirm("Are you sure you want to delete this channel?")) {
                $.ajax({
                    url: '@Url.Action("DeleteChannel", "Marketing")',
                    type: 'POST',
                    data: { ChannelId: channelId },
                    success: function (response) {
                        if (response.success) {
                            $("#row-" + channelId).remove();
                            location.reload();
                        } else {
                            alert("Error deleting channel: " + response.message);
                        }
                    },
                    error: function () {
                        alert("Error occurred while deleting.");
                    }
                });
            }
        }
    </script>
}
