@{
    ViewBag.Title = "campaignMult";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .gs-icon {
        font-size: 30px;
        border-radius: 12px;
        height: 47px;
        width: 47px;
        line-height: 47px;
        text-align: center;
        margin-bottom: 5px;
    }

    table.dataTable thead th.sorting,
    table.dataTable thead th.sorting_asc,
    table.dataTable thead th.sorting_desc {
        background-image: none !important;
        padding-right: 10px !important;
    }
</style>

<div class="container-fluid">
    <div class="form-head d-flex mb-0 mb-lg-4 align-items-start">
        <div class="mr-auto d-none d-lg-block">
            <h2 class="text-black font-w600">Campaign</h2>
            <p class="mb-0">Current campaign list</p>
        </div>
        <div class="d-none d-lg-flex align-items-center">
            <div class="text-right">
                @Html.Partial("_PartialDateTime")
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-12 col-xxl-12 col-lg-12">
            <div class="row">
                <div class="col-xl-12">
                    <div class="card">
                        <div class="card-body">
                            @using (Html.BeginForm("campaignMult", "Marketing", FormMethod.Post))
                            {
                                <div class="form-row">
                                    <div class="form-group col-xl-4">
                                        <label>Channel:</label><span class="text-danger ml-1">*</span><br />
                                        @Html.DropDownList("channel",
                                            new SelectList(ViewBag.lstchannels, "channel_id", "channel_name", ViewBag.channel),
                                            "Select Channel", new { @class = "form-control" })
                                    </div>

                                    <div class="form-group col-xl-4">
                                        <label>Category:</label><span class="text-danger ml-1">*</span><br />
                                        @Html.DropDownList("category",
                                            new SelectList(ViewBag.lstcategory, "campaign_category_id", "campaign_category_name", ViewBag.category),
                                            "Select Category", new { @class = "form-control" })
                                    </div>

                                    <div class="form-group col-xl-4">
                                        <label>Campaign:</label><span class="text-danger ml-1">*</span><br />
                                        @Html.DropDownList("campaign",
                                            new SelectList(ViewBag.lstcampaign, "campaign_id", "campaign_name", ViewBag.campaign),
                                            "Select Campaign", new { @class = "form-control" })
                                    </div>

                                    <div class="form-group col-xl-4">
                                        <label>Sub Campaign</label><span class="text-danger ml-1">*</span><br />
                                        @Html.DropDownList("subcampaign",
                                            new SelectList(ViewBag.lstsubcampaign, "subcampaign_id", "subcampaign_name", ViewBag.subcampaign),
                                            "Select Sub Campaign", new { @class = "form-control" })
                                    </div>

                                    <div class="form-group col-xl-4">
                                        <label>Language</label><span class="text-danger ml-1">*</span><br />
                                        @Html.DropDownList("language",
                                            new SelectList(ViewBag.lstlanguage, "Value", "Text", ViewBag.language),
                                            "Select Language", new { @class = "form-control" })
                                    </div>

                                    <div class="form-group col-xl-4">
                                        <label>Type</label><span class="text-danger ml-1">*</span><br />
                                        @Html.DropDownList("campaigntype",
                                            new SelectList(ViewBag.lsttype, "Value", "Text", ViewBag.type),
                                            "Select Campaign Type", new { @class = "form-control" })
                                    </div>

                                    <div class="form-group col-xl-3" style="padding-top:35px;">
                                        <button type="submit" class="btn btn-warning">Apply Filter</button>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Campaign Creatives</h4>
                            <!-- STATUS BUTTONS REMOVED -->
                        </div>

                        <div class="card-body" style="padding: 0.875rem;">
                            <div class="table-responsive">
                                <table class="table table-responsive-md" id="campaignTable">
                                    <thead>
                                        <tr>
                                            <th>
                                                <label style="display:flex; align-items:center; gap:5px;">
                                                    <input type="checkbox" id="selectAll">All
                                                </label>
                                            </th>
                                            <th>ID</th>
                                            <th>CampaignName</th>
                                            <th>Creative Caption</th>
                                            <th>Count</th>
                                            <th>Action</th>

                                        </tr>
                                    </thead>

                                    <tbody>
                                        @{
            var groupedCampaigns = ((IEnumerable<dynamic>)ViewBag.lstAllCampaigns)
                .GroupBy(c => new { c.CampaignName, c.campaign_master_creative_caption })
                .Select(g => new
                {
                    CampaignMasterId = g.First().campaign_master_id,
                    CampaignName = g.Key.CampaignName,
                    CreativeCaption = g.Key.campaign_master_creative_caption,
                    Count = g.Count()
                }).ToList();
        }
                                      



                                        @foreach (var item in groupedCampaigns)
                                        {
                                            <tr data-id="@item.CampaignMasterId">
                                                <td><input type="checkbox" class="select-campaign" value="@item.CampaignMasterId" /></td>
                                                <td class="row-index"><strong></strong></td>
                                                <td>@item.CampaignName</td>
                                                <td>@item.CreativeCaption</td>
                                                <td><strong>@item.Count</strong></td>

                                                <td>
                                                    <a class="badge badge-rounded badge-success" href="~/Marketing/campaign/@item.CampaignMasterId">
                                                        <i class="fa fa-pencil"></i>
                                                    </a>
                                                    @*<a class="badge badge-rounded badge-primary" href="~/Marketing/campaigndetailsadmin?CampaignMasterId=@item.CampaignMasterId">
                                                        <i class="fa fa-eye"></i>
                                                    </a>*@
                                                </td>
                                            </tr>
                                        }
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

@section js {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {

            var table = $('#campaignTable').DataTable({
                pageLength: 10,
                lengthChange: false,
                paging: false,
                searching: false,
                ordering: false,
                columnDefs: [
                    {
                        targets: 1,
                        render: function (data, type, row, meta) {
                            return meta.row + 1;
                        }
                    }
                ]
            });

            $('#selectAll').on('change', function () {
                $('.select-campaign').prop('checked', this.checked);
            });

        });
    </script>
}
